<!DOCTYPE html><html><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Fomantic-UI Sandbox</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>


    <script type="text/javascript" src="https://fomantic-ui.com/dist/semantic.js"></script>
    <link rel="stylesheet" type="text/css" href="https://fomantic-ui.com/dist/semantic.css">

    <style id="compiled-css" type="text/css">
      body {
  padding: 1em;
}

    /* EOS */
  </style>
</head>
<body>
<h2 class="ui dividing header">
    Fomantic-UI Sandbox
    <div class="sub header">Fork this JSFiddle by hitting the button above</div>
</h2>

<div class="ui container" id="testContainerGenerationArea"></div>
<div class="ui container" style="display:none;" id="testContainerGenerationAreaTest">
    <div class="ui card">
        <div class="content">
            <div class="header">Some awesome test</div>
            <div class="meta">Fork this JSFiddle by hitting the button above</div>
        </div>
        <div class="content">
            <div class="ui feed">
                <h4 class="ui sub header">Hi stranger!</h4>
                <div class="event">
                    <div class="content">
                        This is autogenerated test for you.
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <div class="ui feed">
                <div class="">

                    <div class="ui big form event">
                        <div class="content grouped fields">
                            <label>Do you really like it?</label>
                            <div>

                                <div class="field">
                                    <div class="ui left icon input small fluid">
                                        <textarea style="resize: none;"> I have an left icon</textarea>
                                        <i class="pen nib icon"></i>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui checkbox">
                                        <input type="radio" name="throughput1">
                                        <label>Awesome! <em data-emoji="boom"></em></label>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui checkbox">
                                        <input type="radio" name="throughput2">
                                        <label>That's pretty normal <em data-emoji="eyeglasses"></em></label>
                                    </div>
                                </div>
                                <div class="field">
                                    <div class="ui checkbox">
                                        <input type="radio" name="throughput">
                                        <label>That's awful <em data-emoji="face_with_symbols_over_mouth"></em></label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="extra content">
            <button class="ui small left floated button">Back</button>
            <button class="ui small right floated green button">Check!</button>
        </div>
        <div class="extra content">
            <div class="ui floating red segment">That's not an answer!</div>
            <div class="ui floating green segment">Exactly!</div>
        </div>
    </div>
</div>

<script type="text/javascript">

var testConfig = {
  elemSelector: "#testContainerGenerationArea",
  name: "Просто тест",
  descr: "",
  questions: [
    {
      header: "Привет!",
      content: "Мы старались, пока придумывали это задание.",
      question: "Как тебе оно?",
      type: "single", //single|multiple|text
      answers: [
        { content: 'Супер! <em data-emoji="boom"></em>', isRight: true},
        { content: 'Нормально <em data-emoji="eyeglasses"></em>', isRight: false},
        { content: 'Сложно <em data-emoji="face_with_symbols_over_mouth"></em>', isRight: false},
      ],
      check: {
        val: true,//function return boolean or regexp or true(default single)
        showContentIfSuccess: true, //show message if check is success
        successContent: "Супер!",
        showContentIfFails: true, //show message if check is fail
        showContentAfterFails: 1,
        failContent: "Да блин!",
        goNextIfFails: true, // go to next question if fails
        callback: function(){alert('hi');} // ToDo - write to server callback - only functions
      },
      backBtn: '',
      nextBtn: ''
    },
    {
      header: "Второй вопрос",
      content: "Это последний урок по многопоточности",
      question: "Уже успел разобраться?",
      type: "single", //single|multiple|text
      answers: [
        { content: 'Да! <em data-emoji="boom"></em>', isRight: true},
        { content: 'Пока в процессе <em data-emoji="eyeglasses"></em>', isRight: false},
        { content: 'Не понятно все <em data-emoji="face_with_symbols_over_mouth"></em>', isRight: false},
      ],
      check: {
        val: true,//function return boolean or regexp or true(default single)
        showContentIfSuccess: true, //show message if check is success
        successContent: "Мололец!",
        showContentIfFails: true, //show message if check is fail
        showContentAfterFails: 1,
        failContent: "Подтягивайся!",
        goNextIfFails: true, // go to next question if fails
        callback: null // ToDo - write to server callback - only functions
      },
      backBtn: '',
      nextBtn: ''
    },
  ],
  passedMinCount: 1, // number of success answers
  passedContent: {header:"Ты - мозг!", content:"Продолжай в том же духе!"},
  failedContent: {header:"Все действительно так сложно?", content:"Давай повторим!"},
  restartBtn: "Еще раз!",
  totalCallback: function(result) {
    console.log(JSON.stringify(result));
    $.post(JSON.stringify(result));
  }
};

var questionsTestsApp = function(config) {
  this.config = config;
  this.passedQuestions = [];
  this.currentQuestionId = 0;
  this.currentQuestionUI = 0;
  this.successAnswers = [];
  this.failedAnswers = [];
  this.failedAnswersCounter = 0;
  this.ui = {
    container: null,
    card: null,
    buttons: {
      next: null,
      back: null
    },
    answers: [],
    notifications: null
  };
  return this.init();
};
questionsTestsApp.prototype = {
  init: function() {
    this.ui.container = $(this.config.elemSelector);
    if(!this.ui.card) this.createCard();
    return this;
  },
  createCard: function() {
    this.ui.card = $('<div>', {class:"ui card"})
      .appendTo(this.ui.container);
    this.ui.card.html('<div class="content">' +
      '<div class="header testHeader">Some awesome test</div>' +
      '<div class="meta testDescr">Some awesome test</div>' +
    '</div>' +
    '<div class="content questionContent"></div>' +
    '<div class="content questionAnswersContent"></div>' +
    '<div class="extra content testActions"></div>' +
    '<div class="extra content testNotifications"></div>');
    this.ui.card.find('.testHeader').html(this.config.name);
    this.ui.card.find('.testDescr').html(this.config.descr);
    this.ui.notifications =  this.ui.card.find('.testNotifications');
    this.renderQuestion();
  },
  renderQuestion: function(configID) {
    if(!this.ui.card) return;
    if(this.config.questions.length==0) return;
    if(!configID) {
      configID = 0;
      this.passedQuestions = [];
    }
    this.currentQuestionId = configID;
    var config = this.config.questions[configID];
    this.renderQuestionContent(config);
    this.renderAnswers(config);
    this.renderButtons(config);
    this.ui.notifications.empty();
  },
  renderQuestionContent: function(config) {
    var qc = $('<div>', {class:"ui feed"})
      .appendTo(this.ui.card.find('.questionContent').empty());
      qc.html('<div class="ui feed large">' +
        '<h4 class="ui sub header qcHead"></h4>'+
        '<div class="event"><div class="content qcBody"></div></div>' +
      '</div>');
      qc.find('.qcHead').html(config.header);
      qc.find('.qcBody').html(config.content);
  },
  renderAnswers: function(config) {
    this.ui.answers = [];
    this.failedAnswersCounter = 0;
    this.currentQuestionUI = $('<div>', {class:"ui feed"})
      .appendTo(this.ui.card.find('.questionAnswersContent').empty());
      this.currentQuestionUI.html('<div class="ui feed">' +
        '<div class="ui big form event"><div class="content grouped fields"><label class="qacHead"></label><div class="qacBody"></div></div></div>' +
      '</div>');
      this.currentQuestionUI.find('.qacHead').html(config.question);
      var qacBody = this.currentQuestionUI.find('.qacBody');
      qacBody.empty().attr('data-type', config.type);

      //render Answers
      switch(config.type) {
        case 'single':
          this.renderAnswersSingle(qacBody, config);
        break;
        case 'multiple':
          this.renderAnswersMultiple(qacBody, config);
        break;
        case 'text':
          this.renderAnswersText(qacBody, config);
        break;
        default: break;
      }
  },
  renderAnswersSingle: function(container, config) {
    var s = this, nameId = "RAS_" + (new Date()).getTime().toString();
    config.answers.forEach(function(ans, i){
      var field = $('<div>',{class:"field"}).appendTo(container),
      uniID = nameId + "_" + i;
      field.attr("data-row", i);
      field.html('<div class="ui checkbox">'+
        '<input type="radio" name="' + nameId + '" id="' + uniID + '">'+
        '<label for="' + uniID + '"></label>'+
      '</div>');
      field.find('label').html(ans.content);
      s.ui.answers.push(field);
    });
  },
  renderAnswersMultiple: function(container, config) {
    var nameId = "RAS_" + (new Date()).getTime().toString();
    config.answers.forEach(function(ans, i){
      var field = $('<div>',{class:"field"}).appendTo(container),
      uniID = nameId + "_" + i;
      field.attr("data-row", i);
      field.html('<div class="ui checkbox">'+
        '<input type="checkbox" name="' + uniID + '" id="' + uniID + '">'+
        '<label for="' + uniID + '"></label>'+
      '</div>');
      field.find('label').html(ans.content);
      s.ui.answers.push(field);
    });
  },
  renderAnswersText: function(container, config) {
    var s = this, field = $('<div>',{class:"field"}).appendTo(container);
    field.attr("data-row", i);
    field.html('<div class="ui left icon input small fluid">'+
    '<textarea style="resize: none;"></textarea><i class="pen nib icon"></i>' +
    '</div>');
    s.ui.answers.push(field);
  },
  checkAction: function() {
    var s = this, curQuestion = s.config.questions[s.currentQuestionId];
    s.successAnswers = [];
    s.failedAnswers = [];
    switch(curQuestion.type) {
        case 'single':
        case 'multiple':
          for(var ai = 0; ai < s.ui.answers.length; ai++) {
            var ansEl = s.ui.answers[ai];
            var ansId = parseInt(ansEl.attr("data-row")),
            isChecked = ansEl.find('.checkbox').checkbox("is checked");
            if(curQuestion.answers[ansId] &&
            curQuestion.answers[ansId].isRight == isChecked)
            s.successAnswers.push(ansId);
            else s.failedAnswers.push(ansId);
          }
        break;
        case 'text':
          var answerVal = s.ui.answers[0].find('textarea').val();
          if(curQuestion.check.val.indexOf('(function()')>=0) {
            //JS eval
            try{
              var checkFunc = eval(curQuestion.check.val);
              if(checkFunc(answerVal)) {
                s.successAnswers.push(0);
              } else{
                s.failedAnswers.push(0);
              }
            } catch(e) {console.error(e);}
          } else if(curQuestion.check.val.indexOf('regex::')>=0) {
            var re = curQuestion.check.val.split('regex::')[1];
            if(answerVal.match(re)) {
              s.successAnswers.push(0);
            } else {
              s.failedAnswers.push(0);
            }
          } else {
            if(answerVal.indexOf(curQuestion.check.val)>=0||
              curQuestion.check.val.indexOf(answerVal)>=0)
            s.successAnswers.push(0);
            else s.failedAnswers.push(0);
          }
        break;
     }
     if(s.failedAnswers.length==0) {
      s.passedQuestions.push(s.currentQuestionId);
      if(curQuestion.check.showContentIfSuccess) {
          s.ui.notifications.html($('<div>', {
          class:"ui floating green segment",
          html: curQuestion.check.successContent
         }));
         s.ui.buttons.next.addClass('loading');
         setTimeout(function(){
          s.ui.buttons.next.removeClass('loading');
          s.ui.notifications.html('');
           s.goNext();
         }, 2000);
      } else {
        s.goNext();
      }
     } else {
      s.failedAnswersCounter++;
      if(curQuestion.check.showContentAfterFails <= s.failedAnswersCounter) {
        if(curQuestion.check.showContentIfFails) {
            s.ui.notifications.html($('<div>', {
            class:"ui floating red segment",
            html: curQuestion.check.failContent
           }));
           s.ui.buttons.next.addClass('loading');
           setTimeout(function(){
            s.ui.buttons.next.removeClass('loading');
            s.ui.notifications.html('');
             if(curQuestion.check.goNextIfFails) s.goNext();
           }, 2000);
        } else {
          if(curQuestion.check.goNextIfFails) s.goNext();
        }
      }
     }
  },
  goNext: function() {
      var s = this;
    if(s.currentQuestionId < s.config.questions.length - 1) {
      s.currentQuestionId++;
      s.ui.card.append('<div class="ui active inverted dimmer cardLoader"><div class="ui active blue elastic loader"></div></div>');
      s.renderQuestion(s.currentQuestionId);
      setTimeout(function(){
        s.ui.card.find('.cardLoader').remove();
      }, 1000);
    }
    else s.showTotalInfo();
  },
  showTotalInfo: function() {
    var s = this;
    if(s.passedQuestions.length>0)
    s.passedQuestions = s.passedQuestions.filter(function(value, index, self) {
      return self.indexOf(value) === index;
    });
    var passed = (s.config.passedMinCount <= s.passedQuestions.length);
    s.ui.card.find('.questionAnswersContent').empty();
    s.ui.card.find('.testActions').empty();
    s.renderQuestionContent({
      header: passed ? s.config.passedContent.header : s.config.failedContent.header,
      content: passed ? s.config.passedContent.content : s.config.failedContent.content
    });
    if(s.config.totalCallback) s.config.totalCallback({
              passedQuestions: s.passedQuestions,
              totalQuestions: s.config.questions.length
            });
    s.ui.notifications.html($('<div>',{
          class:"ui small blue button",
          html: s.config.restartBtn ? s.config.restartBtn : "Start again!",
          on:{ click: function() { s.renderQuestion(); }}
        }));
  },
  goBack: function() {
    if(this.currentQuestionId>0)  {
      this.currentQuestionId--;
      this.renderQuestion(this.currentQuestionId);
    }
  },
  renderButtons: function(config) {
  var s = this;
    this.ui.buttons.next = $('<div>',{
          class:"ui small right floated green button",
          html: config['nextBtn'] ? config['nextBtn'] : "Check!",
          on:{ click: function() { s.checkAction(); }}
        });
    this.ui.buttons.back = this.currentQuestionId > 0 ? $('<div>',{
          class:"ui small left floated button",
          html: config['backBtn'] ? config['backBtn'] : "Back",
          on:{ click: function() { s.goBack(); }}
        }) : $('<i>');
    this.ui.card.find('.testActions').empty()
      .append(this.ui.buttons.back)
      .append(this.ui.buttons.next);
  }
};



new questionsTestsApp(testConfig);


</script>

<script>
    // tell the embed parent frame the height of the content
    if (window.parent && window.parent.parent){
      window.parent.parent.postMessage(["resultsFrame", {
        height: document.body.getBoundingClientRect().height,
        slug: ""
      }], "*")
    }

    // always overwrite window.name, in case users try to set it manually
    window.name = "result"
  </script>

<script>
      let allLines = []

      window.addEventListener("message", (message) => {
        if (message.data.console){
          let insert = document.querySelector("#insert")
          allLines.push(message.data.console.payload)
          insert.innerHTML = allLines.join(";\r")

          let result = eval.call(null, message.data.console.payload)
          if (result !== undefined){
            console.log(result)
          }
        }
      })
    </script>



</body></html>